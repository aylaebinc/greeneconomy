left_join(pge_elec_emissions_factor, by = c("Year" = "year"))
ghg_forecast <-
summary_TCO2E_norm_projection %>%
dplyr::select(-`Heating Degree Days`,-`Cooling Degree Days`,-Residents,-Jobs) %>%
mutate(
`Residential Electricity, kBTU/resident/CDD` =
ifelse(
Year < 2020,
`Residential Electricity, kBTU/resident/CDD`,
lm(
`Residential Electricity, kBTU/resident/CDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Residential Electricity, kBTU/resident/CDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Residential Gas, kBTU/resident/HDD` =
ifelse(
Year < 2020,
`Residential Gas, kBTU/resident/HDD`,
lm(
`Residential Gas, kBTU/resident/HDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Residential Gas, kBTU/resident/HDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Electricity, kBTU/job/CDD` =
ifelse(
Year < 2020,
`Commercial Electricity, kBTU/job/CDD`,
lm(
`Commercial Electricity, kBTU/job/CDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Commercial Electricity, kBTU/job/CDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Gas, kBTU/job/HDD` =
ifelse(
Year < 2020,
`Commercial Gas, kBTU/job/HDD`,
lm(
`Commercial Gas, kBTU/job/HDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Commercial Gas, kBTU/job/HDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Gas, kBTU/job/HDD` =
ifelse(
`Commercial Gas, kBTU/job/HDD` < 1,
1,
`Commercial Gas, kBTU/job/HDD`
)
) %>%
left_join(hdd, by = c("Year" = "YEAR")) %>%
left_join(cdd, by = c("Year" = "YEAR")) %>%
left_join(pop_jobs_sjc_w_projection %>% dplyr::select(Year, Population, `Employed Residents`, Jobs), by = "Year") %>%
left_join(stockton_commute_vmt_tractmode %>% dplyr::select(Year, vmt, jobs_car), by = "Year") %>%
mutate(
vmtperjob = vmt/jobs_car
) %>%
dplyr::select(-vmt,-jobs_car) %>%
mutate(
vmtperjob =
ifelse(
Year < 2018,
vmtperjob,
lm(
vmtperjob[1:5] ~ Year[1:5]
)$coefficients[1]+
lm(
vmtperjob[1:5] ~ Year[1:5]
)$coefficients[2]*Year
)
) %>%
left_join(pge_elec_emissions_factor, by = c("Year" = "year"))
ghg_forecast_table <-
ghg_forecast %>%
transmute(
Year = Year,
Population = prettyNum(round(Population,-3),big.mark=","),
`Employed Residents` = prettyNum(round(`Employed Residents`,-3),big.mark=","),
Jobs = prettyNum(round(Jobs,-3),big.mark=","),
`One-way Commute VMT per Car-dependent Worker` = round(vmtperjob),
`PG&E Electricity Emissions Factor` = round(factor),
`Heating Degree Days` = hdd,
`Cooling Degree Days` = cdd,
`Residential Electricity, kBTU/resident/CDD` = round(`Residential Electricity, kBTU/resident/CDD`,1),
`Residential Gas, kBTU/resident/HDD` = round(`Residential Gas, kBTU/resident/HDD`,1),
`Commercial Electricity, kBTU/job/CDD` = round(`Commercial Electricity, kBTU/job/CDD`,1),
`Commercial Gas, kBTU/job/HDD` = round(`Commercial Gas, kBTU/job/HDD`,1)
)
kable(
ghg_forecast_table,
booktabs = TRUE,
caption = 'Input assumptions for GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
ghg_forecast_table_prep <-
ghg_forecast %>%
transmute(
Year = Year,
Population = prettyNum(round(Population,-3),big.mark=","),
`Employed Residents` = prettyNum(round(`Employed Residents`,-3),big.mark=","),
Jobs = prettyNum(round(Jobs,-3),big.mark=","),
`One-way Commute VMT per Car-dependent Worker` = round(vmtperjob),
`PG&E Electricity Emissions Factor` = round(factor),
`Heating Degree Days` = hdd,
`Cooling Degree Days` = cdd,
`Residential Electricity, kBTU/resident/CDD` = round(`Residential Electricity, kBTU/resident/CDD`,1),
`Residential Gas, kBTU/resident/HDD` = round(`Residential Gas, kBTU/resident/HDD`,1),
`Commercial Electricity, kBTU/job/CDD` = round(`Commercial Electricity, kBTU/job/CDD`,1),
`Commercial Gas, kBTU/job/HDD` = round(`Commercial Gas, kBTU/job/HDD`,1)
)
ghg_forecast_table <-
ghg_forecast_table_prep %>%
mutate(
transport = vmtperjob * `Employed Residents` *2*369.39*0.000334,
residential = `Residential Electricity, kBTU/resident/CDD`*Population*cdd*2.9307e-7*0.000453592 + `Residential Gas, kBTU/resident/HDD`*Population*hdd/99.9761*0.00531,
commercial = `Commercial Electricity, kBTU/job/CDD`*Jobs*cdd*2.9307e-7*0.000453592 + `Commercial Gas, kBTU/job/HDD`*Jobs*hdd/99.9761*0.00531
)
ghg_forecast_table <-
ghg_forecast %>%
mutate(
transport = vmtperjob * `Employed Residents` *2*369.39*0.000334,
residential = `Residential Electricity, kBTU/resident/CDD`*Population*cdd*2.9307e-7*0.000453592 + `Residential Gas, kBTU/resident/HDD`*Population*hdd/99.9761*0.00531,
commercial = `Commercial Electricity, kBTU/job/CDD`*Jobs*cdd*2.9307e-7*0.000453592 + `Commercial Gas, kBTU/job/HDD`*Jobs*hdd/99.9761*0.00531
)
ghg_forecast_prep <-
summary_TCO2E_norm_projection %>%
dplyr::select(-`Heating Degree Days`,-`Cooling Degree Days`,-Residents,-Jobs) %>%
mutate(
`Residential Electricity, kBTU/resident/CDD` =
ifelse(
Year < 2020,
`Residential Electricity, kBTU/resident/CDD`,
lm(
`Residential Electricity, kBTU/resident/CDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Residential Electricity, kBTU/resident/CDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Residential Gas, kBTU/resident/HDD` =
ifelse(
Year < 2020,
`Residential Gas, kBTU/resident/HDD`,
lm(
`Residential Gas, kBTU/resident/HDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Residential Gas, kBTU/resident/HDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Electricity, kBTU/job/CDD` =
ifelse(
Year < 2020,
`Commercial Electricity, kBTU/job/CDD`,
lm(
`Commercial Electricity, kBTU/job/CDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Commercial Electricity, kBTU/job/CDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Gas, kBTU/job/HDD` =
ifelse(
Year < 2020,
`Commercial Gas, kBTU/job/HDD`,
lm(
`Commercial Gas, kBTU/job/HDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Commercial Gas, kBTU/job/HDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Gas, kBTU/job/HDD` =
ifelse(
`Commercial Gas, kBTU/job/HDD` < 1,
1,
`Commercial Gas, kBTU/job/HDD`
)
) %>%
left_join(hdd, by = c("Year" = "YEAR")) %>%
left_join(cdd, by = c("Year" = "YEAR")) %>%
left_join(pop_jobs_sjc_w_projection %>% dplyr::select(Year, Population, `Employed Residents`, Jobs), by = "Year") %>%
left_join(stockton_commute_vmt_tractmode %>% dplyr::select(Year, vmt, jobs_car), by = "Year") %>%
mutate(
vmtperjob = vmt/jobs_car
) %>%
dplyr::select(-vmt,-jobs_car) %>%
mutate(
vmtperjob =
ifelse(
Year < 2018,
vmtperjob,
lm(
vmtperjob[1:5] ~ Year[1:5]
)$coefficients[1]+
lm(
vmtperjob[1:5] ~ Year[1:5]
)$coefficients[2]*Year
)
) %>%
left_join(pge_elec_emissions_factor, by = c("Year" = "year"))
ghg_forecast <-
ghg_forecast_prep %>%
transmute(
Year = Year
transport = vmtperjob * `Employed Residents` *2*369.39*0.000334,
ghg_forecast <-
ghg_forecast_prep %>%
transmute(
Year = Year,
transport = vmtperjob * `Employed Residents` *2*369.39*0.000334,
residential = `Residential Electricity, kBTU/resident/CDD`*Population*cdd*2.9307e-7*0.000453592 + `Residential Gas, kBTU/resident/HDD`*Population*hdd/99.9761*0.00531,
commercial = `Commercial Electricity, kBTU/job/CDD`*Jobs*cdd*2.9307e-7*0.000453592 + `Commercial Gas, kBTU/job/HDD`*Jobs*hdd/99.9761*0.00531
)
ghg_forecast_table <-
ghg_forecast %>%
mutate(
`Transportation Emissions` = prettyNum(round(transport,-4),big.mark=","),
`Residential Building Emissions` = prettyNum(round(residential,-3),big.mark=","),
`Commercial Building Emissions` = prettyNum(round(residential,-3),big.mark=",")
)
kable(
ghg_forecast_table,
booktabs = TRUE,
caption = 'GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
ghg_forecast_table <-
ghg_forecast %>%
transmute(
Year=Year,
`Transportation Emissions` = prettyNum(round(transport,-4),big.mark=","),
`Residential Building Emissions` = prettyNum(round(residential,-3),big.mark=","),
`Commercial Building Emissions` = prettyNum(round(residential,-3),big.mark=",")
)
kable(
ghg_forecast_table,
booktabs = TRUE,
caption = 'GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
ghg_forecast_table <-
ghg_forecast %>%
transmute(
Year=Year,
`Transportation tCO2` = prettyNum(round(transport,-4),big.mark=","),
`Residential Building tCO2` = prettyNum(round(residential,-3),big.mark=","),
`Commercial Building tCO2` = prettyNum(round(residential,-3),big.mark=",")
)
kable(
ghg_forecast_table,
booktabs = TRUE,
caption = 'GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
ghg_forecast_table <-
ghg_forecast %>%
transmute(
Year=Year,
`Transportation tCO2` = prettyNum(round(transport,-4),big.mark=","),
`Residential Building tCO2` = prettyNum(round(residential,-3),big.mark=","),
`Commercial Building tCO2` = prettyNum(round(commercial,-3),big.mark=",")
)
kable(
ghg_forecast_table,
booktabs = TRUE,
caption = 'GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
View(summary_TCO2E_average)
kable(
ghg_forecast_table_prep,
booktabs = TRUE,
caption = 'Input assumptions for GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
ghg_forecast_prep <-
summary_TCO2E_norm_projection %>%
dplyr::select(-`Heating Degree Days`,-`Cooling Degree Days`,-Residents,-Jobs) %>%
mutate(
`Residential Electricity, kBTU/resident/CDD` =
ifelse(
Year < 2020,
`Residential Electricity, kBTU/resident/CDD`,
lm(
`Residential Electricity, kBTU/resident/CDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Residential Electricity, kBTU/resident/CDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Residential Gas, kBTU/resident/HDD` =
ifelse(
Year < 2020,
`Residential Gas, kBTU/resident/HDD`,
lm(
`Residential Gas, kBTU/resident/HDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Residential Gas, kBTU/resident/HDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Electricity, kBTU/job/CDD` =
ifelse(
Year < 2020,
`Commercial Electricity, kBTU/job/CDD`,
lm(
`Commercial Electricity, kBTU/job/CDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Commercial Electricity, kBTU/job/CDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Gas, kBTU/job/HDD` =
ifelse(
Year < 2020,
`Commercial Gas, kBTU/job/HDD`,
lm(
`Commercial Gas, kBTU/job/HDD`[1:6] ~ Year[1:6]
)$coefficients[1]+
lm(
`Commercial Gas, kBTU/job/HDD`[1:6] ~ Year[1:6]
)$coefficients[2]*Year
),
`Commercial Gas, kBTU/job/HDD` =
ifelse(
`Commercial Gas, kBTU/job/HDD` < 1,
1,
`Commercial Gas, kBTU/job/HDD`
)
) %>%
left_join(hdd, by = c("Year" = "YEAR")) %>%
left_join(cdd, by = c("Year" = "YEAR")) %>%
left_join(pop_jobs_stockton_w_projection %>% dplyr::select(Year, Population, `Employed Residents`, Jobs), by = "Year") %>%
left_join(stockton_commute_vmt_tractmode %>% dplyr::select(Year, vmt, jobs_car), by = "Year") %>%
mutate(
vmtperjob = vmt/jobs_car
) %>%
dplyr::select(-vmt,-jobs_car) %>%
mutate(
vmtperjob =
ifelse(
Year < 2018,
vmtperjob,
lm(
vmtperjob[1:5] ~ Year[1:5]
)$coefficients[1]+
lm(
vmtperjob[1:5] ~ Year[1:5]
)$coefficients[2]*Year
)
) %>%
left_join(pge_elec_emissions_factor, by = c("Year" = "year"))
ghg_forecast_table_prep <-
ghg_forecast_prep %>%
transmute(
Year = Year,
Population = prettyNum(round(Population,-3),big.mark=","),
`Employed Residents` = prettyNum(round(`Employed Residents`,-3),big.mark=","),
Jobs = prettyNum(round(Jobs,-3),big.mark=","),
`One-way Commute VMT per Car-dependent Worker` = round(vmtperjob),
`PG&E Electricity Emissions Factor` = round(factor),
`Heating Degree Days` = hdd,
`Cooling Degree Days` = cdd,
`Residential Electricity, kBTU/resident/CDD` = round(`Residential Electricity, kBTU/resident/CDD`,1),
`Residential Gas, kBTU/resident/HDD` = round(`Residential Gas, kBTU/resident/HDD`,1),
`Commercial Electricity, kBTU/job/CDD` = round(`Commercial Electricity, kBTU/job/CDD`,1),
`Commercial Gas, kBTU/job/HDD` = round(`Commercial Gas, kBTU/job/HDD`,1)
)
kable(
ghg_forecast_table_prep,
booktabs = TRUE,
caption = 'Input assumptions for GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
ghg_forecast <-
ghg_forecast_prep %>%
transmute(
Year = Year,
transport = vmtperjob * `Employed Residents` *2*369.39*0.000334,
residential = `Residential Electricity, kBTU/resident/CDD`*Population*cdd*2.9307e-7*0.000453592 + `Residential Gas, kBTU/resident/HDD`*Population*hdd/99.9761*0.00531,
commercial = `Commercial Electricity, kBTU/job/CDD`*Jobs*cdd*2.9307e-7*0.000453592 + `Commercial Gas, kBTU/job/HDD`*Jobs*hdd/99.9761*0.00531
)
ghg_forecast_table <-
ghg_forecast %>%
transmute(
Year=Year,
`Transportation tCO2` = prettyNum(round(transport,-4),big.mark=","),
`Residential Building tCO2` = prettyNum(round(residential,-3),big.mark=","),
`Commercial Building tCO2` = prettyNum(round(commercial,-3),big.mark=",")
)
kable(
ghg_forecast_table,
booktabs = TRUE,
caption = 'GHG forecast to 2040.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
kable(
summary_TCO2E_average_table,
booktabs = TRUE,
caption = 'Stockton annual residential and commercial energy usage, 2013 to 2018. Data from PG&E.'
) %>%
kable_styling() %>%
scroll_box(width = "100%")
View(summary_TCO2E_norm)
(2760723140/3.4121416331)
2712035205/3.4121416331
include_graphics("images/diagram.jpg")
```{r diagram, fig.cap="GHG model diagram."}
include_graphics("images/diagram.jpg")
library(tidyverse)
library(tidyverse)
library(tigris)
setwd("~/GitHub/218y-team1-climate/fema_policies")
library(sf)
library(ggplot2)
library(censusapi)
library(mapview)
library(lattice)
mapviewOptions(basemaps = "OpenStreetMap")
options(
tigris_class = "sf",
tigris_use_cache = TRUE
)
foia_policy_1 <- NA
for (year in 1980:2006) {
file_path <- paste0("F:/Restricted Data Library/FEMA/Redacted Policies Part 1/Redacted foia_policy_201907_data_",year,"0331_1_of_1.csv")
foia_policy_df <- read.csv(file_path)
foia_policy_1 <-
foia_policy_1 %>%
rbind(foia_policy_df)
print(year)
}
foia_policy_tot4 <- NA
foia_policy_tot4 <- NA
foia_policy_tot4 <- NA
for(part in 1:5) {
for (year in 2017:2019) {
file_path <- paste0("F:/Restricted Data Library/FEMA/Redacted Policies Part 1/Redacted foia_policy_201907_data_",year,"0331_",part,"_of_5.csv")
print(year)
foia_policy_df <- read.csv(file_path)
foia_policy_tot4 <-
foia_policy_tot4 %>%
rbind(foia_policy_df )
}}
foia_policy_tot4 <- NA
for(part in 1:2) {
for (year in 2014) {
file_path <- paste0("F:/Restricted Data Library/FEMA/Redacted Policies Part 1/Redacted foia_policy_201907_data_",year,"0331_",part,"_of_5.csv")
print(year)
foia_policy_df <- read.csv(file_path)
foia_policy_tot4 <-
foia_policy_tot4 %>%
rbind(foia_policy_df)
}
}
foia_policy_tot4 <- NA
for(part in 1:2) {
for (year in 2014) {
file_path <- paste0("F:/Restricted Data Library/FEMA/Redacted Policies Part 4/Redacted foia_policy_201907_data_",year,"0331_",part,"_of_5.csv")
print(year)
foia_policy_df <- read.csv(file_path)
foia_policy_tot4 <-
foia_policy_tot4 %>%
rbind(foia_policy_df)
}
}
foia_policy_tot4 <- NA
part <- 2
year <- 2016
# for(part in 1:5) {
#   for (year in 2014:2016) {
file_path <- paste0("F:/Restricted Data Library/FEMA/Redacted Policies Part 4/Redacted foia_policy_201907_data_",year,"0331_",part,"_of_5.csv")
file_path
foia_policy_df <- read.csv(file_path)
library(censusapi)
library(tidyverse)
library(tigris)
library(sf)
library(mapview)
library(raster)
library(rgeos)
library(data.table)
library(RColorBrewer)
library(rlang)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
mapviewOptions(
basemaps = "OpenStreetMap"
)
options(
tigris_class = "sf",
tigris_use_cache = TRUE
)
setwd("~/GitHub/218y-team3-floodrisk")
epa_parcels_zoning <-
st_read("epa_parcels_zoning/epa_parcels_zoning.shp")
mapview(epa_parcels_zoning, zcol = "Zoning")
setwd("~/GitHub/greeneconomy")
